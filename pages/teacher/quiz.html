<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quiz Page</title>

    <!-- Tailwind CSS-->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />

    <!-- BS + BS Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
  </head>

  <body class="bg-[#F9FAFB] min-h-screen p-4">
    <div class="max-w-[1600px] mx-auto flex flex-col md:flex-row gap-10">
      <!-- KOTAKAN UTAMA SMUA -->
      <!-- Sidebar Start -->
      <nav
        class="bg-[#1F2A44] rounded-xl w-full md:w-60 flex flex-col justify-between p-6 text-[#a3c0d9] h-[calc(100vh-3rem)]"
      >
        <!-- Nav Atas Start-->
        <!-- LOGO -->
        <div>
          <a
            id="brandTitle"
            class="text-white d-block font-extrabold text-lg mb-4 mt-2 text-center"
            href=""
          >
            <span>EverGreen</span>
          </a>

          <hr class="border-[#ffffff] mb-5" />

          <nav class="flex flex-col gap-5 text-sm">
            <a
              class="flex items-center gap-3 text-[#ffffff] hover:text-[#9FD3C7] transition-colors"
              href="/dashboard/teacher"
            >
              <i class="bi bi-grid-1x2"></i>
              <span class="title">Dashboard</span>
            </a>

            <a
              class="flex items-center gap-3 text-[#ffffff]"
              href="/all_schedule"
            >
              <i class="bi bi-calendar3"></i>
              <span class="title">Schedules</span>
            </a>

            <a
              class="flex items-center gap-3 text-[#ffffff] hover:text-[#9FD3C7] transition-colors"
              href="/teacher/students"
            >
              <i class="bi bi-people-fill"></i>
              <span class="title">Students</span>
            </a>

            <a
              class="flex items-center gap-3 text-[#9FD3C7] hover:text-[#9FD3C7] transition-colors"
              href="/topicTeacher"
            >
              <i class="bi bi-question-circle-fill"></i>
              <span class="title">Quizzes</span>
            </a>

            <a
              class="flex items-center gap-3 text-[#ffffff] hover:text-[#9FD3C7] transition-colors"
              href="/payment"
            >
              <i class="bi bi-credit-card-2-back"></i>
              <span class="title">Payment History</span>
            </a>
          </nav>
        </div>
        <!-- Nav Atas End-->

        <div>
          <!-- Nav Bawah Start-->
          <hr class="border-[#ffffff] mb-6" />
          <nav class="flex flex-col gap-5 text-sm font-semibold text-[#a3c0d9]">
            <a
              class="flex items-center gap-3 text-[#ffffff] hover:text-[#9FD3C7] transition-colors"
              href="/profile"
            >
              <i class="bi bi-person-circle"></i>
              <span class="title">Profile</span>
            </a>

            <a class="flex items-center gap-3 text-[#ffffff] hover:text-[#9FD3C7] transition-colors" href="#" id="logoutTrigger" >
              <i class="bi bi-box-arrow-right"></i>
              <span class="title">Log out</span>
            </a>
          </nav>
        </div>
        <!-- Nav bawah End-->
      </nav>
      <!-- Sidebar End -->

      <!-- Overlay for popup -->
      <div id="overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"></div>

      <!-- Confirm Modal -->
      <div id="confirmModal" class="fixed inset-0 hidden bg-[#000000] bg-opacity-50 flex items-center justify-center z-50">
        <div
          class="bg-white p-6 rounded-lg shadow-md text-center max-w-sm w-full">
          <h2 class="mb-4 text-xl font-semibold">Delete Topic</h2>
          <p class="mb-3">Are you sure you want to delete this quiz?</p>
          <div class="flex justify-center gap-4">
            <button id="confirmNo" class="w-[140px] bg-[#FFFFFF] border-2 border-[#9FD3C7] px-4 py-2 rounded hover:bg-[#9FD3C7] transition">No</button>
            <button id="confirmYes" class="w-[140px] bg-[#9FD3C7] text-[#000000] px-4 py-2 rounded hover:bg-[#57998A] hover:text-white">Yes</button>
          </div>
        </div>
      </div>

      <!-- Main Content Start -->
      <main class="flex-1 flex flex-col gap-6 pt-8 pr-7">
        <!-- Main Judul -->
        <section>
          <h2
            id="topicTitle"
            class="text-3xl font-extrabold text-[#111827] mb-1"
          >
            Loading Quiz..
          </h2>
          <p id="topicDescription" class="text-sm text-[#6b7280]">
            Organize and assign vocabulary quizzes to enhance student learning.
          </p>
        </section>

        <hr />

        <!-- Button All Quiz & Action Start -->
        <div class="flex justify-end items-center">
          <div class="flex justify-between items-center gap-3">
            <a id="add-Btn">
              <button
                class="whitespace-nowrap text-[#FFFFFF] px-3 py-2 text-center bg-[#1F2A44] rounded-lg font-medium hover:bg-[#CED6ED] hover:text-[#000000] transition transition-all duration-300"
              >
                <i class="bi bi-plus-lg mr-2"></i>Add Quiz
              </button>
            </a>

            <a>
              <button
                id="action-Btn"
                class="whitespace-nowrap text-[#000000] px-3 py-2 text-center bg-[#CEE8E2] rounded-lg font-medium hover:bg-[#9FD3C7] transition transition-all duration-300"
              >
                <i class="bi bi-hand-index-thumb-fill mr-2"></i>Action
              </button>
            </a>
          </div>
        </div>
        <!-- Button All Quiz & Action End -->

        <!-- Jadwal -->
        <div>
          <!-- Schedule Table -->
          <div
            class="max-h-[492px] overflow-y-auto scroll-container bg-white rounded-xl overflow-hidden shadow-md"
          >
            <table class="min-w-full text-sm text-left">
              <thead class="bg-[#1F2A44] text-white">
                <tr>
                  <th class="py-3 px-4 font-semibold sticky top-0 bg-[#1F2A44] z-10">No</th>
                  <th
                    class="py-3 px-4 font-semibold sticky top-0 bg-[#1F2A44] z-10"
                  >
                    Quiz Link
                  </th>
                  <th
                    class="py-3 px-4 font-semibold sticky top-0 bg-[#1F2A44] z-10"
                  >
                    Result Link
                  </th>
                </tr>
              </thead>

              <tbody id="quizTableBody" class="text-gray-700">
                <!-- Data jadwal di sini -->
              </tbody>
            </table>
          </div>
        </div>
        <!-- Jadwal End-->

        <!-- Add Quiz Modal -->
        <div
          id="addQuizModal"
          class="hidden fixed inset-0 bg-[#000000] bg-opacity-50 flex items-center justify-center z-20"
        >
          <div
            class="bg-[#FFFFFF] p-8 rounded-2xl shadow-md text-center max-w-md w-full"
          >
            <h2 class="text-2xl mb-4 font-bold">Add Quiz Link</h2>
            <form id="addQuizForm" class="space-y-4">
              <!-- Quiz Link -->
              <div>
                <label
                  for="addQuizName"
                  class="block mb-1 text-left font-medium"
                  >Quiz Link (Google Form)</label
                >
                <input
                  type="text"
                  id="addQuizName"
                  name="addQuizName"
                  required
                  class="w-full border border-gray-300 px-3 py-2 rounded"
                  placeholder="Form"
                />
              </div>

              <!-- Result Link -->
              <div>
                <label
                  for="addResultName"
                  class="block mb-1 text-left font-medium"
                  >Result Link (Google Spreadsheet)</label
                >
                <input
                  type="text"
                  id="addResultName"
                  name="addResultName"
                  required
                  class="w-full border border-gray-300 px-3 py-2 rounded"
                  placeholder="Spreadsheet"
                />
              </div>

              <!-- Button -->
              <div class="flex justify-end gap-4 pt-4">
                <button
                  type="button"
                  id="cancelAddQuiz"
                  class="w-[190px] bg-[#FFFFFF] border-2 border-[#9FD3C7] px-4 py-2 rounded hover:bg-[#9FD3C7] transition"
                >
                  Cancel
                </button>

                <button
                  type="submit"
                  class="w-[190px] bg-[#9FD3C7] text-[#000000] px-4 py-2 rounded hover:bg-[#57998A] hover:text-white"
                >
                  Add Quiz
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Action Popup Template -->
        <div
          id="actionPopupTemplate"
          class="hidden absolute right-0 mt-2 rounded-xl shadow-md p-2 w-[170px] bg-white z-50 flex flex-col items-center"
        >
          <h2 class="text-lg font-semibold mb-2 text-[#000000]">Action</h2>
          <div
            class="right-0 mt-2 w-full bg-[#FFF7D4] rounded whitespace-nowrap"
          >
            <button
              class="edit-btn text-[#000000] px-4 py-2 w-full text-left hover:bg-[#E6D99F] rounded"
            >
              <i class="bi bi-pencil-square mr-2"></i>Edit Quiz
            </button>
          </div>
          <div
            class="right-0 mt-2 w-full whitespace-nowrap bg-[#FFE4E6] rounded"
          >
            <button
              class="delete-btn text-[#000000] px-3 py-2 w-full text-left hover:bg-[#E2B0B5] rounded"
            >
              <i class="bi bi-trash3-fill mr-2"></i>Delete Quiz
            </button>
          </div>
        </div>

        <!-- Edit Topic MOdal -->
        <div
          id="editQuizModal"
          class="hidden fixed inset-0 bg-[#000000] bg-opacity-50 flex items-center justify-center z-50"
        >
          <div class="bg-[#FFFFFF] p-6 rounded-lg shadow-md w-full max-w-md">
            <h2 class="text-xl font-semibold mb-4 text-center">
              Edit Quiz Link
            </h2>
            <form action="editQuizForm" class="space-y-4">
              <!-- Quiz Link -->
              <div>
                <label for="editQuizName" class="block font-medium mb-1"
                  >Quiz Link (Google Form)</label
                >
                <input
                  type="text"
                  id="editQuizName"
                  name="editQuizName"
                  required
                  class="w-full border border-gray-300 px-3 py-2 rounded"
                />
              </div>

              <!-- Result Link -->
              <div>
                <label for="editResultName" class="block font-medium mb-1"
                  >Quiz Link (Google Form)</label
                >
                <input
                  type="text"
                  id="editResultName"
                  name="editResultName"
                  required
                  class="w-full border border-gray-300 px-3 py-2 rounded"
                />
              </div>

              <!-- Button -->
              <div class="flex justify-end gap-4 pt-4">
                <button
                  type="button"
                  id="cancelEditQuiz"
                  class="w-[190px] bg-[#FFFFFF] border-2 border-[#9FD3C7] px-4 py-2 rounded hover:bg-[#9FD3C7] transition"
                >
                  Cancel
                </button>

                <button
                  type="submit"
                  class="w-[190px] bg-[#9FD3C7] border-2 border-[#9FD3C7] text-[#000000] px-4 py-2 rounded hover:bg-[#57998A] hover:text-white"
                >
                  Update
                </button>
              </div>
            </form>
          </div>
        </div>

        <!-- Modal Logout -->
        <div
          id="confirmLogout"
          class="fixed inset-0 hidden bg-[#000000] bg-opacity-50 flex items-center justify-center z-50"
        >
          <div
            class="bg-white p-6 rounded-lg shadow-md text-center max-w-sm w-full"
          >
            <h2 class="mb-4 text-xl font-semibold">Logout</h2>
            <p class="mb-3">Are you sure you want to log out?</p>
            <div class="flex justify-center gap-4">
              <button
                id="confirmNoLogout"
                class="w-[140px] bg-[#FFFFFF] border-2 border-[#9FD3C7] px-4 py-2 rounded hover:bg-[#9FD3C7] transition"
              >
                No
              </button>
              <button
                id="confirmYesLogout"
                class="w-[140px] bg-[#9FD3C7] text-[#000000] px-4 py-2 rounded hover:bg-[#57998A] hover:text-white"
              >
                Yes
              </button>
            </div>
          </div>
        </div>

        <script>
          document.addEventListener("DOMContentLoaded", () => {
            // === VARIABEL TAMBAHAN ===
            let isActionMode = false;
            let currentDeleteId = null;
            
            const getParam = (param) => new URLSearchParams(location.search).get(param);
            const topicId = getParam("topic_id");

            const quizTable = document.getElementById("quizTableBody");
            const topicTitle = document.getElementById("topicTitle");
            const addBtn = document.getElementById("add-Btn");
            const addModal = document.getElementById("addQuizModal");
            const actionBtn = document.getElementById("action-Btn");
            const cancelAdd = document.getElementById("cancelAddQuiz");
            const addForm = document.getElementById("addQuizForm");
            const overlay = document.getElementById("overlay");


            // ==== 1. FETCH TOPIC ====
            async function fetchTopicDetail() {
              try {
                const res = await fetch(`/api/topicTeacher/${topicId}`, {
                  credentials: "include",
                });
                const topic = await res.json();
                topicTitle.textContent = topic.name || "Topic - Quiz";
              } catch (err) {
                console.error("Failed fetch topic:", err);
              }
            }

            // ==== 2. FETCH QUIZ TANPA CHECKBOX ====
            async function fetchQuizData() {
              try {
                const res = await fetch(
                  `/api/quizTeacher?topic_id=${topicId}`,
                  { credentials: "include" }
                );
                const data = await res.json();
                quizTable.innerHTML = ""; // Kosongkan tabel

                if (data.length === 0) {
                  quizTable.innerHTML = 
                  `<tr>
                    <td colspan="3" class="text-center py-4 text-gray-500">There is no quiz</td>
                  </tr>`;
                  return;
                }

                data.forEach((quiz, index) => {
                  console.log(quiz);
                  const row = document.createElement("tr");
                  row.classList.add("border-t");
                  row.innerHTML = `
                    <td class="py-3 px-4">${index + 1}</td>
                    <td class="py-3 px-4"><a href="${
                      quiz.quiz_link
                    }" target="_blank" class="text-blue-600 underline">Quiz Form ${
                    index + 1
                  }</a></td>
                    <td class="py-3 px-4"><a href="${
                      quiz.result_link
                    }" target="_blank" class="text-green-600 underline">Result Sheet ${
                    index + 1
                  }</a></td>
                  `;
                  quizTable.appendChild(row);
                });
              } catch (err) {
                console.error("Gagal fetch quiz:", err);
              }
            }

            // === 3. FETCH QUIZ DENGAN CHECKBOX ===
            async function fetchQuizDataWithCheckboxes() {
              try {
                const res = await fetch(
                  `/api/quizTeacher?topic_id=${topicId}`,
                  { credentials: "include" }
                );
                const data = await res.json();
                quizTable.innerHTML = ""; // Kosongkan tabel

                if (data.length === 0) {
                  quizTable.innerHTML = `<tr><td colspan="4" class="text-center py-4 text-gray-500">There is no quiz</td></tr>`;
                  return;
                }

                data.forEach((quiz, index) => {
                  const row = document.createElement("tr");
                  row.classList.add("border-t");
                  row.innerHTML = `
                    <td class="py-3 px-4">
                      <input type="checkbox" class="quiz-checkbox" data-id="${
                        quiz.quiz_id
                      }" /></td>
                    <td class="py-3 px-4">${index + 1}</td>
                    <td class="py-3 px-4"><a href="${
                      quiz.quiz_link
                    }" target="_blank" class="text-blue-600 underline">Quiz Form ${
                    index + 1
                  }</a></td>
                    <td class="py-3 px-4"><a href="${
                      quiz.result_link
                    }" target="_blank" class="text-green-600 underline">Result Sheet ${
                    index + 1
                  }</a></td>
                  `;
                  quizTable.appendChild(row);
                });

                // 4. Add event listener to checkboxes
                const checkboxes = document.querySelectorAll(".quiz-checkbox");
                let currentPopup = null; // untuk menyimpan popup yang aktif

                checkboxes.forEach((checkbox) => {
                  checkbox.addEventListener("change", (e) => {
                    // Jika sudah ada popup sebelumnya, hapus dulu
                    if (currentPopup) {
                      currentPopup.remove();
                      overlay.classList.add("hidden");
                    }

                    if (e.target.checked) {
                      overlay.classList.remove("hidden");

                      checkboxes.forEach((cb) => {
                        if (cb !== e.target) cb.checked = false;
                      });

                      const popup = document
                        .getElementById("actionPopupTemplate")
                        .cloneNode(true);
                      popup.classList.remove("hidden");
                      popup.style.position = "absolute";
                      const rect = e.target.getBoundingClientRect();
                      popup.style.top = `${rect.top + window.scrollY}px`;
                      popup.style.left = `${rect.right + 10}px`;

                      document.body.appendChild(popup);
                      currentPopup = popup; // Simpan popup aktif

                      // Tombol edit/delete
                      popup.querySelector(".edit-btn").onclick = () => {
                        openEditModal(checkbox.dataset.id);
                        popup.remove();
                        overlay.classList.add("hidden");
                        e.target.checked = false;
                      };

                      popup.querySelector(".delete-btn").onclick = () => {
                        confirmDelete(checkbox.dataset.id);
                        popup.remove();
                        overlay.classList.add("hidden");
                        e.target.checked = false;
                      };

                      // Mencegah klik di dalam popup menutup popup
                      popup.addEventListener("click", (event) => {
                        event.stopPropagation();
                      });

                      // Tambahkan listener global hanya sekali, dan biarkan aktif
                      setTimeout(() => {
                        const handler = function (event) {
                          if (!popup.contains(event.target) && event.target !== e.target) {
                            popup.remove();
                            overlay.classList.add("hidden");
                            e.target.checked = false;
                            currentPopup = null;

                            document.removeEventListener("click", handler);
                          }
                        };

                        document.addEventListener("click", handler);
                      }, 0);
                    } else {
                      overlay.classList.add("hidden");
                      if (currentPopup) {
                        currentPopup.remove();
                        currentPopup = null;
                      }
                    }
                  });
                });
              } catch (err) {
                console.error("Gagal fetch quiz:", err);
              }
            }

            // ==== 5. MODAL TAMBAH QUIZ ====
            addBtn.addEventListener("click", () => addModal.classList.remove("hidden"));
            cancelAdd.addEventListener("click", () => {
              addModal.classList.add("hidden");
              addForm.reset();
            });

            // ==== 4. SIMPAN QUIZ KE DB ====
            addForm.addEventListener("submit", async (e) => {
              e.preventDefault();
              const quizLink = document
                .getElementById("addQuizName")
                .value.trim();
              const resultLink = document
                .getElementById("addResultName")
                .value.trim();
              if (!quizLink || !resultLink)
                return alert("Mohon isi semua field.");

              try {
                const res = await fetch("/api/quizTeacher", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  credentials: "include",
                  body: JSON.stringify({ quizLink, resultLink, topicId }),
                });

                const data = await res.json();
                if (data.success) {
                  await fetchQuizData(); // Refresh table
                  showStatus("Quiz successfully added!", "/assets/success.png");
                  addForm.reset();
                  addModal.classList.add("hidden");
                } else {
                  showStatus("Failed to save quiz!", "/assets/error.png");
                }
              } catch (err) {
                console.error("DETAIL ERROR:", err);
                showStatus(err.message || "Something went wrong!", "/assets/error.png");
              }
            });

            // ==== 5. TOGGLE ACTION MODE ====
            actionBtn.addEventListener("click", async () => {
              isActionMode = !isActionMode;

              if (isActionMode) {
                // Mode Action Aktif
                actionBtn.classList.remove("bg-[#CEE8E2]", "hover:bg-[#9FD3C7]");
                actionBtn.classList.add("bg-[#9FD3C7]", "hover:bg-[#CEE8E2]");
                actionBtn.innerHTML = '<i class="bi bi-x-circle mr-2"></i>Close Action';

                // Add checkbox column to the table
                const thead = document.querySelector("thead tr");
                thead.innerHTML = `
                  <th class="py-3 px-4 font-semibold sticky top-0 bg-[#1F2A44] z-10">Select</th>
                  <th class="py-3 px-4 font-semibold sticky top-0 bg-[#1F2A44] z-10">No</th>
                  <th class="py-3 px-4 font-semibold sticky top-0 bg-[#1F2A44] z-10">Quiz Link</th>
                  <th class="py-3 px-4 font-semibold sticky top-0 bg-[#1F2A44] z-10">Result Link</th>
                `;

                // Fetch and display quiz data with checkboxes
                await fetchQuizDataWithCheckboxes();
              } else {
                // Mode Action Nonaktif
                actionBtn.classList.remove("bg-[#9FD3C7]", "hover:bg-[#CEE8E2]");
                actionBtn.classList.add("bg-[#CEE8E2]", "hover:bg-[#9FD3C7]");
                actionBtn.innerHTML = '<i class="bi bi-hand-index-thumb-fill mr-2"></i>Action';

                // Remove checkbox column from the table
                const thead = document.querySelector("thead tr");
                thead.innerHTML = `
                  <th class="py-3 px-4 font-semibold sticky top-0 bg-[#1F2A44] z-10">No</th>
                  <th class="py-3 px-4 font-semibold sticky top-0 bg-[#1F2A44] z-10">Quiz Link</th>
                  <th class="py-3 px-4 font-semibold sticky top-0 bg-[#1F2A44] z-10">Result Link</th>
                `;

                // Fetch and display quiz data without checkboxes
                await fetchQuizData();
              }
            });

            
                
            // ==== 6. LOAD SAAT PERTAMA KALI ====
            fetchTopicDetail();
            fetchQuizData();

            // === Edit Quiz Modal ===
            async function openEditModal(quizId) {
              try {
                const res = await fetch(`/api/quizTeacher/${quizId}`, {
                  method: "GET",
                  credentials: "include",
                });
                const quiz = await res.json();

                document.getElementById("editQuizName").value = quiz.quiz_link;
                document.getElementById("editResultName").value = quiz.result_link;
                document.getElementById("editQuizModal").classList.remove("hidden");

                const editForm = document.querySelector("#editQuizModal form");

               editForm.onsubmit = async function (e) {
                  e.preventDefault();
                  const updatedQuizLink = document.getElementById("editQuizName").value.trim();
                  const updatedResultLink = document.getElementById("editResultName").value.trim();

                  try {
                    const updateRes = await fetch(`/api/quizTeacher/${quizId}`, {
                      method: "PUT",
                      headers: { "Content-Type": "application/json" },
                      credentials: "include",
                      body: JSON.stringify({
                        quizLink: updatedQuizLink,
                        resultLink: updatedResultLink,
                      }),
                    });

                    const updateData = await updateRes.json();
                    if (updateData.success) {
                      document.getElementById("editQuizModal").classList.add("hidden");
                      showStatus("Quiz successfully updated!", "/assets/success.png");
                      exitActionMode();
                    } else {
                      showStatus("❌ Failed to update quiz.", "/assets/error.png");
                    }
                  } catch (err) {
                    console.error("Gagal update:", err);
                    showStatus("❌ Terjadi kesalahan saat update.", "/assets/error.png");
                  }
                };
              } catch (err) {
                console.error("Gagal fetch quiz by ID:", err);
                alert("❌ Tidak bisa buka data quiz.");
              }
            }

            // Tombol cancel modal edit
            document.getElementById("cancelEditQuiz").addEventListener("click", () => {
              document.getElementById("editQuizModal").classList.add("hidden");
            });

            // === DELETE KONFIRMASI MODAL ===
            function confirmDelete(quizId) {
              currentDeleteId = quizId;
              document.getElementById("confirmModal").classList.remove("hidden");
            }

            document.getElementById("confirmYes").addEventListener("click", async () => {
              if (!currentDeleteId) return;
              try {
                const res = await fetch(`/api/quizTeacher/${currentDeleteId}`, {
                  method: "DELETE",
                  credentials: "include",
                });
                const data = await res.json();
                if (data.success) {
                  showStatus("Quiz succesfully deleted.", "/assets/success.png");
                  exitActionMode();
                } else {
                  showStatus("❌ Gagal menghapus quiz.", "/assets/error.png");
                }
              } catch (err) {
                console.error("Gagal hapus quiz:", err);
                showStatus("❌ Terjadi kesalahan.", "/assets/error.png");
              } finally {
                document.getElementById("confirmModal").classList.add("hidden");
                currentDeleteId = null;
              }
            });

            document.getElementById("confirmNo").addEventListener("click", () => {
              document.getElementById("confirmModal").classList.add("hidden");
              currentDeleteId = null;
            });

            function exitActionMode() {
              isActionMode = false;

              actionBtn.classList.add("bg-[#CEE8E2]");
              actionBtn.classList.remove("bg-[#9FD3C7]");
              actionBtn.innerHTML =
                '<i class="bi bi-hand-index-thumb-fill mr-2"></i>Action';

              // Reset kolom header
              const thead = document.querySelector("thead tr");
              thead.innerHTML = `
                          <th class="py-3 px-4 font-semibold sticky top-0 bg-[#1F2A44] z-10">No</th>
                          <th class="py-3 px-4 font-semibold sticky top-0 bg-[#1F2A44] z-10">Quiz Link</th>
                          <th class="py-3 px-4 font-semibold sticky top-0 bg-[#1F2A44] z-10">Result Link</th>
                        `;

              // Fetch data tanpa checkbox
              fetchQuizData();
            }
          });

          const logoutTrigger = document.getElementById('logoutTrigger');
          const confirmLogout = document.getElementById('confirmLogout');
          const confirmYesLogout = document.getElementById('confirmYesLogout');
          const confirmNoLogout = document.getElementById('confirmNoLogout');

          // Tampilkan modal saat klik "Log out"
          logoutTrigger.addEventListener('click', (e) => {
            e.preventDefault();
            confirmLogout.classList.remove('hidden');
          });

          // Klik "No" → sembunyikan modal
          confirmNoLogout.addEventListener('click', () => {
            confirmLogout.classList.add('hidden');
          });

          // Klik "Yes" → redirect ke logout
          confirmYesLogout.addEventListener('click', () => {
            window.location.href = "/logout"; // atau fetch POST kalau pakai method post
          });
        </script>
      </main>
      <!-- Main Content End -->
    </div>
    <!-- KOTAKAN UTAMA SMUA end -->

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
      import { setupStatusModal, showStatus } from '/js/statusModal.js';
      setupStatusModal();
      window.showStatus = showStatus;
    </script>
  </body>
</html>

<!-- CSS -->
<style>
  body {
    font-family: "Poppins", sans-serif;
  }

  #brandTitle {
    font-size: 30px;
  }

  .title {
    font-size: 18px;
    font-weight: 600;
    text-decoration: none; /* ini penting kalau pakai <a> */
  }

  .navbar-custom {
    background-color: #1f2a44;
    margin: 15px;
    border-radius: 15px;
    font-weight: bolder;
    letter-spacing: 0.5px;
  }

  .scroll-container {
    scroll-behavior: smooth;
    -webkit-overflow-scrolling: touch;
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .scroll-container::-webkit-scrollbar {
    display: none;
  }

  .scroll-container {
    cursor: grab;
  }

  .scroll-container:active {
    cursor: grabbing;
  }
</style>
